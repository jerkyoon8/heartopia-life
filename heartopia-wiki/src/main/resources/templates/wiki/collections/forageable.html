<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forageable Collection - Heartopia Wiki</title>
    <!-- Pretendard Font -->
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Common CSS -->
    <link rel="stylesheet" href="/css/common.css">
    <!-- Wiki Filter JS -->
    <script src="/js/wiki-filter.js" defer></script>
    <style>
        .wiki-item-image {
            background: #F7F6F6 !important;
        }
    </style>
</head>

<body>
    <!-- Navbar (Common Fragment) -->
    <div th:replace="~{fragments/header :: header}"></div>
    <div class="mw-body">
        <div class="page-header"><i class="fas fa-leaf fa-2x text-success"></i>
            <h1>채집 도감 (Forageable Collection)</h1>
        </div>
        <p class="text-secondary mb-4">하트피아 대륙 곳곳에서 채집하거나 주울 수 있는 다양한 아이템들에 대한 정보입니다.</p>

        <!-- Filter Bar -->
        <div class="filter-bar">
            <!-- Search -->
            <div class="filter-group" style="flex-grow: 2;">
                <i class="fas fa-search text-secondary"></i>
                <input type="text" id="searchInput" class="search-input" placeholder="이름 검색...">
            </div>
            <!-- Filters -->
            <select id="locationFilter" class="filter-select">
                <option value="all">모든 장소</option>
                <!-- Options populated by JS -->
            </select>

            <!-- Sort & Reset (Fragment) -->
            <div th:replace="~{fragments/wiki-components :: sortAndReset}"></div>
        </div>

        <div class="wiki-grid-layout" id="wikiGrid">
            <div class="no-results" id="noResults"><i class="fas fa-search fa-3x mb-3 text-muted"></i>
                <p>검색 결과가 없습니다.</p>
            </div>

            <!-- Forageable Card Loop -->
            <div th:each="item : ${forageableList}" class="wiki-item-card" th:data-name="${item.name}"
                th:data-location="${item.location}" th:data-price="${item.price}">

                <div class="wiki-item-image">
                    <img th:if="${item.imageUrl != null}" th:src="${item.imageUrl}" th:alt="${item.name}"
                        style="max-height: 100px; object-fit: contain;">
                    <i th:if="${item.imageUrl == null}" class="fas fa-seedling fa-4x text-success"
                        style="opacity: 0.7;"></i>
                </div>

                <div class="wiki-item-info">
                    <a href="#" class="wiki-item-name" th:text="${item.name}">채집물 이름</a>
                    <div class="mt-2 text-center">
                        <a th:href="@{/wiki/map(cat='forageable', name=${item.name})}"
                            class="wiki-item-tag location-link">
                            <i class="fas fa-map-marker-alt me-1"></i>
                            <span th:text="${item.location}">서식지</span>
                        </a>
                    </div>
                </div>

                <table class="wiki-item-stats">
                    <tr>
                        <td class="stat-label">판매 가격</td>
                        <td class="stat-value">
                            <i class="fas fa-coins text-warning me-1"></i>
                            <span th:text="${#numbers.formatInteger(item.price, 0, 'COMMA')}">0</span>
                        </td>
                    </tr>
                    <tr>
                        <td class="stat-label">에너지 회복</td>
                        <td class="stat-value">
                            <i class="fas fa-bolt text-info me-1"></i>
                            <span th:text="${item.energy}">-</span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Footer (Common Fragment) -->
        <div th:replace="~{fragments/footer :: footer}"></div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                new WikiFilter({
                    gridId: 'wikiGrid',
                    itemSelector: '.wiki-item-card',
                    filters: [
                        { id: 'locationFilter', dataKey: 'location', autoPopulate: true }
                    ]
                });
            });
        </script>
</body>

</html>